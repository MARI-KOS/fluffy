<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PROFILE - Prince Fuwamocchi III</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Italiana&family=Zen+Kaku+Gothic+New:wght@400;500;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary-color: #333333;
        --text-body: #444444;
        --accent-pink: #ff8cb6;
        --accent-blue: #70e8e0;
        --accent-gold: #f0d550;
        --bg-color: #ffffff;
        --glass-bg: rgba(255, 255, 255, 0.9);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        background: radial-gradient(1200px 800px at 15% 20%, rgba(255, 140, 182, 0.14), transparent 60%),
          radial-gradient(1000px 700px at 85% 30%, rgba(112, 232, 224, 0.14), transparent 55%),
          radial-gradient(900px 600px at 50% 90%, rgba(240, 213, 80, 0.12), transparent 55%),
          #fff;
        font-family: "Zen Kaku Gothic New", sans-serif;
        color: var(--primary-color);
        overflow: hidden;
        height: 100vh;
        line-height: 1.8;
      }

      body.loaded {
        overflow-y: auto;
        height: auto;
      }

      /* Loading Screen */
      #loading-screen {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1), transform 1.2s cubic-bezier(0.4, 0, 0.2, 1),
          visibility 1.2s;
      }

      #loading-screen.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transform: scale(1.06);
      }

      .loading-logo {
        font-family: "Playfair Display", serif;
        font-style: italic;
        font-size: clamp(2.2rem, 4vw, 3.5rem);
        color: var(--accent-pink);
        margin-bottom: 1.25rem;
        text-shadow: 0px 0px 15px rgba(255, 140, 182, 0.28);
        text-align: center;
      }

      .loading-bar-container {
        width: 220px;
        height: 4px;
        background: #f5f5f5;
        border-radius: 10px;
        overflow: hidden;
      }

      .loading-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--accent-blue), var(--accent-pink));
        transition: width 0.12s linear;
      }

      .loading-text {
        margin-top: 1rem;
        font-family: "Italiana", serif;
        font-size: 0.9rem;
        letter-spacing: 0.2em;
        color: #888;
      }

      /* Background Canvas (Three.js) */
      #canvas-container {
        position: fixed;
        inset: 0;
        z-index: 0;
        opacity: 1;
      }
      #canvas-container canvas {
        display: block;
      }

      /* Layout */
      .page-container {
        position: relative;
        z-index: 10;
        width: 100%;
        opacity: 0;
        transition: opacity 1.5s ease;
      }
      .page-container.visible {
        opacity: 1;
      }

      section {
        min-height: 100vh;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 6rem 1.5rem;
      }

      h1,
      h2,
      h3 {
        margin: 0;
      }

      .section-title {
        font-family: "Italiana", serif;
        font-size: clamp(2.8rem, 5vw, 4.5rem);
        margin-bottom: 4rem;
        background: linear-gradient(45deg, var(--accent-pink), var(--accent-blue));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.05));
        text-align: center;
      }

      /* Navigation */
      nav {
        position: fixed;
        top: 0;
        right: 0;
        padding: 2.2rem 2.4rem;
        z-index: 100;
        display: flex;
        gap: 1.8rem;
        opacity: 0;
        transition: opacity 1s ease 1s;
      }
      .loaded nav {
        opacity: 1;
      }

      .nav-item {
        text-decoration: none;
        color: var(--primary-color);
        font-family: "Italiana", serif;
        font-size: 1.2rem;
        letter-spacing: 0.1em;
        transition: color 0.3s;
        font-weight: 600;
      }
      .nav-item:hover {
        color: var(--accent-pink);
      }

      /* Hero */
      .hero-section {
        height: 100vh;
        text-align: center;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 1.5rem;
      }
      .hero-content {
        opacity: 0;
        transform: translateY(20px);
        transition: all 1.8s cubic-bezier(0.2, 1, 0.3, 1) 0.5s;
        margin-top: 0;
      }
      .loaded .hero-content {
        opacity: 1;
        transform: translateY(0);
      }
      .hero-logo {
        font-family: "Playfair Display", serif;
        font-style: italic;
        font-size: clamp(1.4rem, 2.5vw, 2rem);
        color: var(--accent-pink);
        letter-spacing: 0.1em;
        margin-bottom: 1rem;
        display: block;
      }
      .hero-title {
        font-family: "Italiana", serif;
        font-size: clamp(3.6rem, 9.5vw, 8rem);
        font-weight: 400;
        line-height: 0.95;
        margin-bottom: 2rem;
        letter-spacing: -0.03em;
      }
      .hero-desc {
        font-size: 1.1rem;
        letter-spacing: 0.12em;
        color: #666;
        text-transform: uppercase;
        font-weight: 700;
      }
      .scroll-hint {
        position: absolute;
        bottom: 3rem;
        left: 50%;
        transform: translateX(-50%);
        font-family: "Italiana", serif;
        font-size: 0.9rem;
        letter-spacing: 0.2em;
        color: var(--accent-pink);
        font-weight: bold;
        animation: bounce 2s infinite;
        opacity: 0;
        transition: opacity 1s ease 1.5s;
      }
      .loaded .scroll-hint {
        opacity: 1;
      }
      @keyframes bounce {
        0%,
        100% {
          transform: translate(-50%, 0);
        }
        50% {
          transform: translate(-50%, 10px);
        }
      }

      /* About */
      .glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(30px);
        -webkit-backdrop-filter: blur(30px);
        border: 1px solid #fff;
        border-radius: 20px;
        padding: 4.2rem 3.6rem;
        width: 100%;
        max-width: 1000px;
        box-shadow: 0 20px 60px rgba(255, 140, 182, 0.1);
        display: flex;
        flex-direction: row;
        gap: 4.2rem;
        align-items: center;
        opacity: 0;
        transform: translateY(40px);
        transition: all 1s ease;
      }
      .glass-card.visible {
        opacity: 1;
        transform: translateY(0);
      }
      @media (max-width: 800px) {
        nav {
          padding: 1.4rem 1.2rem;
          gap: 1.1rem;
        }
        .glass-card {
          flex-direction: column;
          padding: 3rem 2rem;
          gap: 2.4rem;
        }
      }
      .profile-img-wrapper {
        flex: 1;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.06);
        max-width: 380px;
        width: 100%;
        background: #eee;
        aspect-ratio: 1;
      }
      .profile-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transform: scale(1.02);
      }
      .profile-text {
        flex: 1.3;
        text-align: left;
      }
      .profile-name {
        font-family: "Italiana", serif;
        font-size: 3rem;
        margin-bottom: 0.5rem;
      }
      .profile-role {
        font-family: "Playfair Display", serif;
        font-style: italic;
        font-size: 1.2rem;
        color: var(--accent-pink);
        letter-spacing: 0.05em;
        margin-bottom: 2rem;
        display: block;
        font-weight: 700;
      }
      .profile-desc {
        line-height: 2.2;
        color: var(--text-body);
        margin-bottom: 0;
        font-size: 1.1rem;
        font-weight: 500;
      }

      /* Favorites / Slider */
      .slider-section {
        padding: 6rem 0 0 0;
        height: 100vh;
        overflow: hidden;
      }
      .slider-container {
        width: 100%;
        max-width: 1200px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 0 1rem;
      }
      .slider-header-wrapper {
        text-align: center;
        margin-bottom: 1.5rem;
        position: relative;
        z-index: 20;
      }
      .slider-wrapper {
        display: flex;
        transition: transform 0.8s cubic-bezier(0.2, 1, 0.3, 1);
        width: 100%;
        padding: 2rem 0;
        touch-action: pan-y;
      }
      .slide {
        min-width: 100%;
        padding: 0 0.75rem;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0.4;
        transition: opacity 0.6s ease, transform 0.6s ease;
        transform: scale(0.92);
      }
      .slide.active {
        opacity: 1;
        transform: scale(1);
      }
      .work-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(18px);
        padding: 3.2rem;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(200, 200, 255, 0.1);
        display: flex;
        flex-direction: row;
        gap: 3.2rem;
        width: 100%;
        max-width: 1000px;
        align-items: center;
        border: 1px solid #fff;
      }
      @media (max-width: 768px) {
        .work-card {
          flex-direction: column;
          padding: 2.3rem;
          gap: 1.8rem;
        }
      }
      .work-img-area {
        flex: 1.2;
        overflow: hidden;
        border-radius: 12px;
        position: relative;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
        background-color: #ffeef5;
        aspect-ratio: 4/3;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .work-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.8s ease;
      }
      .work-img-area:hover .work-img {
        transform: scale(1.06);
      }
      .work-info {
        flex: 1.2;
        text-align: left;
      }
      .work-cat {
        font-family: "Italiana", serif;
        font-size: 1rem;
        color: var(--accent-blue);
        letter-spacing: 0.1em;
        margin-bottom: 0.8rem;
        display: block;
        font-weight: 800;
      }
      .work-title {
        font-family: "Playfair Display", serif;
        font-size: 2.6rem;
        margin-bottom: 1.2rem;
        line-height: 1.1;
      }
      .work-desc {
        font-size: 1.05rem;
        line-height: 2;
        color: var(--text-body);
        margin: 0;
        font-weight: 500;
      }
      /* swipe hint (optional) */
      .swipe-hint {
        margin-top: 0.5rem;
        text-align: center;
        font-family: "Italiana", serif;
        letter-spacing: 0.12em;
        color: rgba(51, 51, 51, 0.55);
        font-size: 0.95rem;
        user-select: none;
      }

      /* Contact */
      .contact-form-wrapper {
        position: relative;
        z-index: 50;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(22px);
        padding: 3.6rem 3.6rem;
        border-radius: 20px;
        width: 100%;
        max-width: 650px;
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.8s ease;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.06);
        text-align: center;
        border: 1px solid #fff;
      }
      .contact-form-wrapper.visible {
        opacity: 1;
        transform: translateY(0);
      }
      .contact-intro {
        margin: 0 0 2.4rem 0;
        line-height: 2;
        color: var(--text-body);
        font-size: 1.1rem;
        font-weight: 500;
      }
      .form-row {
        margin-bottom: 2rem;
        text-align: left;
      }
      .form-label {
        display: block;
        font-family: "Italiana", serif;
        font-size: 1.1rem;
        letter-spacing: 0.05em;
        margin-bottom: 0.6rem;
        color: var(--accent-pink);
        font-weight: 900;
      }
      .form-control {
        width: 100%;
        padding: 1.05rem;
        border: 2px solid #eee;
        border-radius: 10px;
        background: #fff;
        font-family: inherit;
        font-size: 1.05rem;
        transition: all 0.3s;
        color: #333;
      }
      .form-control:focus {
        outline: none;
        border-color: var(--accent-pink);
        box-shadow: 0 0 0 4px rgba(255, 140, 182, 0.15);
      }
      .submit-btn {
        margin-top: 0.5rem;
        display: inline-block;
        padding: 1.1rem 4.2rem;
        background: linear-gradient(45deg, var(--accent-pink), #ffbedb);
        color: #fff;
        border: none;
        font-family: "Italiana", serif;
        font-size: 1.2rem;
        letter-spacing: 0.1em;
        cursor: pointer;
        transition: all 0.3s;
        border-radius: 999px;
        box-shadow: 0 10px 20px rgba(255, 140, 182, 0.28);
        font-weight: 900;
      }
      .submit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 26px rgba(255, 140, 182, 0.3);
      }
      footer {
        padding: 3rem 1rem;
        font-size: 0.9rem;
        color: #888;
        text-align: center;
        font-family: "Italiana", serif;
        letter-spacing: 0.05em;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div id="loading-screen" aria-live="polite">
      <div class="loading-logo">Prince Fuwamocchi III</div>
      <div class="loading-bar-container" role="progressbar" aria-valuemin="0" aria-valuemax="100">
        <div class="loading-bar" id="loading-bar"></div>
      </div>
      <p class="loading-text">LOADING...</p>
    </div>

    <div id="canvas-container" aria-hidden="true"></div>

    <div class="page-container">
      <nav>
        <a href="#about" class="nav-item">About</a>
        <a href="#works" class="nav-item">Favorites</a>
        <a href="#contact" class="nav-item">Contact</a>
      </nav>

      <section class="hero-section">
        <div class="hero-content">
          <span class="hero-logo">My Profile</span>
          <h1 class="hero-title">Prince Fuwamocchi III<br />Official</h1>
          <p class="hero-desc">I'm a Fluffy Genius!</p>
        </div>
        <div class="scroll-hint">SCROLL DOWN</div>
      </section>

      <section id="about">
        <h2 class="section-title">About Me</h2>
        <div class="glass-card scroll-anim">
          <div class="profile-img-wrapper">
            <img class="profile-img" src="images/1.png" alt="Prince Fuwamocchi III" />
          </div>
          <div class="profile-text">
            <h3 class="profile-name">Prince Fuwamocchi III</h3>
            <span class="profile-role">I'm a Fluffy Genius!</span>
            <p class="profile-desc">
              私の好きなものや、日々の「推し」を紹介するサイトです。<br />
              ゆっくりしていってくださいね！
            </p>
          </div>
        </div>
      </section>

      <section id="movie">
        <h2 class="section-title">Movie</h2>
        <div class="glass-card scroll-anim" style="flex-direction: column; text-align: center;">
          <p class="profile-desc" style="margin-bottom: 2rem;">ふわふわな日常を送っているよ</p>
          <video controls playsinline preload="metadata" style="width: 100%; max-width: 900px; border-radius: 16px; box-shadow: 0 12px 30px rgba(0,0,0,0.08);">
            <source src="videos/weryai_1770532067183.mp4" type="video/mp4" />
            お使いのブラウザは動画タグに対応していません。
          </video>
        </div>
      </section>

      <section id="works" class="slider-section">
        <div class="slider-container">
          <div class="slider-header-wrapper">
            <h2 class="section-title" style="margin-bottom: 0">My Favorites</h2>
          </div>

          <div class="slider-wrapper" id="sliderWrapper" aria-live="polite">
            <div class="slide active">
              <div class="work-card">
                <div class="work-img-area">
                  <img class="work-img" src="images/2.png" alt="Favorite 01: キラキラしたもの" />
                </div>
                <div class="work-info">
                  <span class="work-cat">Favorite 01</span>
                  <h3 class="work-title">キラキラしたもの</h3>
                  <p class="work-desc">
                    自分の瞳に映る自分自身が一番キラキラしていてお気に入りだけど、たまに窓に映った自分に「あら、素敵な子ね」って挨拶しちゃうの。
                  </p>
                </div>
              </div>
            </div>

            <div class="slide">
              <div class="work-card">
                <div class="work-img-area">
                  <img class="work-img" src="images/3.png" alt="Favorite 02: 王冠のメンテナンス" />
                </div>
                <div class="work-info">
                  <span class="work-cat">Favorite 02</span>
                  <h3 class="work-title">王冠のメンテナンス</h3>
                  <p class="work-desc">
                    すぐ頭から滑り落ちちゃうから、毎日角度を研究しているわ。でも最近、乗せるより「乗ってる気分」でいる方が大事だって気づいたのよ。
                  </p>
                </div>
              </div>
            </div>

            <div class="slide">
              <div class="work-card">
                <div class="work-img-area">
                  <img class="work-img" src="images/4.png" alt="Favorite 03: マシュマロのお昼寝" />
                </div>
                <div class="work-info">
                  <span class="work-cat">Favorite 03</span>
                  <h3 class="work-title">マシュマロのお昼寝</h3>
                  <p class="work-desc">マシュマロを食べながら寝るのが大好きなの。フワフワだからセーフだわ！</p>
                </div>
              </div>
            </div>

            <div class="slide">
              <div class="work-card">
                <div class="work-img-area">
                  <img class="work-img" src="images/nagi.jpg" alt="Favorite 04: おともだち" />
                </div>
                <div class="work-info">
                  <span class="work-cat">Favorite 04</span>
                  <h3 class="work-title">おともだち</h3>
                  <p class="work-desc">いつもそばにいてくれる大切な存在。フワフワな時間を一緒に過ごすのが好き。</p>
                </div>
              </div>
            </div>
          </div>

          <div class="swipe-hint">Swipe</div>
        </div>
      </section>

      <section id="contact">
        <h2 class="section-title">Contact</h2>
        <div class="contact-form-wrapper scroll-anim">
          <p class="contact-intro">感想やメッセージをお待ちしています！</p>
          <form id="myContactForm">
            <div class="form-row">
              <label class="form-label">Name</label>
              <input type="text" name="name" class="form-control" placeholder="お名前" required />
            </div>
            <div class="form-row">
              <label class="form-label">Email</label>
              <input type="email" name="email" class="form-control" placeholder="メールアドレス" required />
            </div>
            <div class="form-row">
              <label class="form-label">Message</label>
              <textarea name="message" class="form-control" rows="4" placeholder="メッセージ" style="resize: vertical" required></textarea>
            </div>
            <button type="submit" class="submit-btn">Send Message</button>
          </form>
        </div>
        <footer>&copy; 2026 Prince Fuwamocchi III. All Rights Reserved.</footer>
      </section>
    </div>

    <script type="text/plain" data-disabled="legacy-script">
      // --- Loading Logic ---
      document.addEventListener("DOMContentLoaded", () => {
        const loadingScreen = document.getElementById("loading-screen");
        const loadingBar = document.getElementById("loading-bar");
        const pageContainer = document.querySelector(".page-container");
        const body = document.body;

        let progress = 0;
        const timer = setInterval(() => {
          progress += Math.random() * 4;
          if (progress >= 100) {
            progress = 100;
            clearInterval(timer);
            loadingBar.style.width = "100%";

            setTimeout(() => {
              loadingScreen.classList.add("hidden");
              pageContainer.classList.add("visible");
              body.classList.add("loaded");
              setTimeout(() => (loadingScreen.style.display = "none"), 1500);
            }, 600);
          } else {
            loadingBar.style.width = progress + "%";
          }
        }, 20);
      });

      // --- Scroll Animation ---

        function dbg(lines) {
          if (!debugEl || debugEl.hidden) return;
          debugEl.textContent = lines.filter(Boolean).join("\n");
        }

        function initCanvasFallback(reason) {
          const canvas = document.getElementById("fx-canvas");
          if (!canvas) return;
          canvas.style.display = "block";
          const ctx = canvas.getContext("2d");
          if (!ctx) return;

          const dpr = Math.min(window.devicePixelRatio || 1, 2);
          let w = 0;
          let h = 0;
          function resize() {
            w = Math.floor(window.innerWidth);
            h = Math.floor(window.innerHeight);
            canvas.width = Math.floor(w * dpr);
            canvas.height = Math.floor(h * dpr);
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
          }
          resize();
          window.addEventListener("resize", resize);

          const target = { x: w * 0.5, y: h * 0.45 };
          const pos = { x: target.x, y: target.y };

          const pink = { r: 255, g: 191, b: 216 };
          const blue = { r: 191, g: 245, b: 255 };
          const gold = { r: 255, g: 242, b: 191 };

          function setTarget(x, y) {
            target.x = Math.max(0, Math.min(w, x));
            target.y = Math.max(0, Math.min(h, y));
          }
          window.addEventListener("mousemove", (e) => setTarget(e.clientX, e.clientY), { passive: true });
          window.addEventListener(
            "touchmove",
            (e) => {
              const t = e.touches?.[0];
              if (t) setTarget(t.clientX, t.clientY);
            },
            { passive: true },
          );

          function blob(x, y, r, cA, cB, a) {
            const g = ctx.createRadialGradient(x, y, 0, x, y, r);
            g.addColorStop(0, `rgba(${cA.r},${cA.g},${cA.b},${a})`);
            g.addColorStop(0.55, `rgba(${cB.r},${cB.g},${cB.b},${a * 0.55})`);
            g.addColorStop(1, "rgba(255,255,255,0)");
            ctx.fillStyle = g;
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
            ctx.fill();
          }

          let lastT = performance.now();
          function frame(t) {
            const dt = Math.min(0.05, (t - lastT) / 1000);
            lastT = t;
            const k = 1 - Math.pow(0.001, dt);
            pos.x += (target.x - pos.x) * k;
            pos.y += (target.y - pos.y) * k;

            ctx.clearRect(0, 0, w, h);
            ctx.globalCompositeOperation = "lighter";
            blob(pos.x, pos.y, 180, pink, blue, 0.35);
            blob(pos.x + 20, pos.y - 12, 140, blue, gold, 0.22);
            blob(pos.x - 18, pos.y + 14, 130, pink, gold, 0.18);
            requestAnimationFrame(frame);
          }
          requestAnimationFrame(frame);

          dbg([
            "FX: Canvas fallback",
            `reason: ${reason || "unknown"}`,
            "",
            "Try online network for three.js CDN, or open with ?debug=1.",
          ]);
        }

        const container = document.getElementById("canvas-container");
        if (!container) return;
        if (!window.THREE) {
          initCanvasFallback("three.js not loaded");
          return;
        }

        const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);
        // 参考コードに合わせて alpha:true（白背景に自然に馴染む）
        const renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
        renderer.debug.checkShaderErrors = true;
        // 黒いクリア色だと「光の周りが黒」に見えやすいので、パステル背景に寄せる
        renderer.setClearColor(0xffffff, 1);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // 参考コードの挙動に寄せる（可能ならFloat、それが無理ならHalf/Byteへフォールバック）
        const isWebGL2 = renderer.capabilities.isWebGL2;
        const hasHalf = isWebGL2 || !!renderer.extensions.get("OES_texture_half_float");
        const hasFloat = isWebGL2 || !!renderer.extensions.get("OES_texture_float");
        const rtType = hasFloat ? THREE.FloatType : hasHalf ? THREE.HalfFloatType : THREE.UnsignedByteType;

        const needLinearExt =
          rtType === THREE.FloatType
            ? "OES_texture_float_linear"
            : rtType === THREE.HalfFloatType
              ? "OES_texture_half_float_linear"
              : null;
        const hasLinear = isWebGL2 || !needLinearExt || !!renderer.extensions.get(needLinearExt);
        const rtFilter = hasLinear ? THREE.LinearFilter : THREE.NearestFilter;

        const rtOpts = {
          minFilter: rtFilter,
          magFilter: rtFilter,
          format: THREE.RGBAFormat,
          type: rtType,
          depthBuffer: false,
          stencilBuffer: false,
        };

        let size = new THREE.Vector2(window.innerWidth, window.innerHeight);
        let targetA = new THREE.WebGLRenderTarget(size.x, size.y, rtOpts);
        let targetB = targetA.clone();

        const simFS = `
          uniform sampler2D u_buffer;
          uniform vec2 u_resolution;
          uniform vec2 u_mouse;
          uniform float u_time;
          uniform float u_moving;

          vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
          vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
          vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }
          float snoise(vec2 v) {
              const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);
              vec2 i = floor(v + dot(v, C.yy)); vec2 x0 = v - i + dot(i, C.xx);
              vec2 i1; i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
              vec4 x12 = x0.xyxy + C.xxzz; x12.xy -= i1;
              i = mod289(i); vec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));
              vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
              m = m*m; m = m*m; vec3 x = 2.0 * fract(p * C.www) - 1.0;
              vec3 h = abs(x) - 0.5; vec3 ox = floor(x + 0.5); vec3 a0 = x - ox;
              m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);
              vec3 g; g.x = a0.x * x0.x + h.x * x0.y; g.yz = a0.yz * x12.xz + h.yz * x12.yw;
              return 130.0 * dot(m, g);
          }

          void main() {
            vec2 uv = gl_FragCoord.xy / u_resolution;
            vec2 texel = 1.0 / u_resolution;
            vec2 aspect = vec2(u_resolution.x / u_resolution.y, 1.0);

            // Pastel palette
            vec3 pink = vec3(1.0, 0.75, 0.85);
            vec3 blue = vec3(0.7, 0.95, 1.0);
            vec3 gold = vec3(1.0, 0.95, 0.7);

            // Flow field (soft curl noise)
            vec2 vel = vec2(
              snoise(uv * 2.6 + u_time * 0.12),
              snoise(uv * 2.6 + u_time * 0.12 + 10.0)
            ) * 0.003;

            // Advection
            vec3 adv = texture2D(u_buffer, uv - vel).rgb;

            // Diffusion (laplacian)
            vec3 up = texture2D(u_buffer, uv + vec2(0.0, texel.y)).rgb;
            vec3 dn = texture2D(u_buffer, uv - vec2(0.0, texel.y)).rgb;
            vec3 lf = texture2D(u_buffer, uv - vec2(texel.x, 0.0)).rgb;
            vec3 rt = texture2D(u_buffer, uv + vec2(texel.x, 0.0)).rgb;
            vec3 lap = (up + dn + lf + rt - 4.0 * adv);
            vec3 diff = adv + lap * 0.22;

            // Fade toward white to avoid dark accumulation (weaker for richer color)
            diff = mix(diff, vec3(1.0), 0.0025);

            // Ink injection at mouse
            float d = distance(uv * aspect, u_mouse * aspect);
            float ink = exp(-d * 55.0) * u_moving;
            vec3 dyn = mix(pink, blue, sin(u_time * 0.7 + uv.x * 2.5) * 0.5 + 0.5);
            dyn = mix(dyn, gold, cos(u_time * 0.5 + uv.y * 3.0) * 0.5 + 0.5);
            dyn = max(dyn, vec3(0.85));
            // Boost saturation/brightness a bit
            dyn = clamp(dyn * 1.08, 0.0, 1.0);

            vec3 outCol = mix(diff, dyn, ink * 0.85);
            gl_FragColor = vec4(outCol, 1.0);
          }
        `;

        const drawFS = `
          uniform sampler2D u_texture;
          uniform vec2 u_resolution;
          void main() {
            vec2 uv = gl_FragCoord.xy / u_resolution;
            vec3 color = clamp(texture2D(u_texture, uv).rgb, 0.0, 1.0);
            float w = length(color);
            // Push color presence for more vivid look
            vec3 finalCol = mix(vec3(1.0), color, smoothstep(0.01, 0.22, w));
            gl_FragColor = vec4(finalCol, 1.0);
          }
        `;

        const simMaterial = new THREE.ShaderMaterial({
          uniforms: {
            u_buffer: { value: null },
            u_resolution: { value: size },
            u_mouse: { value: new THREE.Vector2(-1, -1) },
            u_time: { value: 0 },
            u_moving: { value: 0.0 },
          },
          vertexShader: `void main() { gl_Position = vec4(position, 1.0); }`,
          fragmentShader: simFS,
        });

        const drawMaterial = new THREE.ShaderMaterial({
          uniforms: { u_texture: { value: null }, u_resolution: { value: size } },
          vertexShader: `void main() { gl_Position = vec4(position, 1.0); }`,
          fragmentShader: drawFS,
        });

        const plane = new THREE.PlaneGeometry(2, 2);
        const simScene = new THREE.Scene();
        simScene.add(new THREE.Mesh(plane, simMaterial));
        const drawScene = new THREE.Scene();
        drawScene.add(new THREE.Mesh(plane, drawMaterial));

        const mouse = new THREE.Vector2(-1, -1);
        let isMoving = 0.0;
        function updateMouse(x, y) {
          mouse.set(x / window.innerWidth, 1 - y / window.innerHeight);
          isMoving = 1.0;
        }
        window.addEventListener("mousemove", (e) => updateMouse(e.clientX, e.clientY), { passive: true });
        window.addEventListener(
          "touchmove",
          (e) => {
            const t = e.touches?.[0];
            if (t) updateMouse(t.clientX, t.clientY);
          },
          { passive: true },
        );

        function onResize() {
          size = new THREE.Vector2(window.innerWidth, window.innerHeight);
          renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
          renderer.setSize(size.x, size.y);
          simMaterial.uniforms.u_resolution.value = size;
          drawMaterial.uniforms.u_resolution.value = size;
          targetA.dispose();
          targetB.dispose();
          targetA = new THREE.WebGLRenderTarget(size.x, size.y, rtOpts);
          targetB = targetA.clone();
        }
        window.addEventListener("resize", onResize);

        function animate() {
          requestAnimationFrame(animate);
          simMaterial.uniforms.u_buffer.value = targetA.texture;
          simMaterial.uniforms.u_time.value += 0.02;
          simMaterial.uniforms.u_mouse.value = mouse;
          simMaterial.uniforms.u_moving.value = isMoving;

          isMoving *= 0.94;

          renderer.setRenderTarget(targetB);
          renderer.render(simScene, camera);

          renderer.setRenderTarget(null);
          drawMaterial.uniforms.u_texture.value = targetB.texture;
          renderer.render(drawScene, camera);

          const t = targetA;
          targetA = targetB;
          targetB = t;
        }
        animate();

        dbg([
          "FX: Three.js shader",
          `webgl2: ${renderer.capabilities.isWebGL2}`,
          `rtType: UnsignedByte`,
          `devicePixelRatio: ${window.devicePixelRatio || 1}`,
          `size: ${window.innerWidth}x${window.innerHeight}`,
          "Tip: open /?debug=1 to view this panel",
        ]);
      })();

      // --- Scroll Animation ---
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) entry.target.classList.add("visible");
          });
        },
        { threshold: 0.15 },
      );
      document.querySelectorAll(".scroll-anim").forEach((el) => observer.observe(el));

      // --- Slider Logic ---
      const sliderWrapper = document.getElementById("sliderWrapper");
      let isAnimating = false;

      function updateClasses() {
        Array.from(sliderWrapper.children).forEach((slide, index) => {
          if (index === 0) slide.classList.add("active");
          else slide.classList.remove("active");
        });
      }

      function moveNext() {
        if (isAnimating) return;
        isAnimating = true;

        sliderWrapper.style.transition = "transform 0.8s cubic-bezier(0.2, 1, 0.3, 1)";
        sliderWrapper.style.transform = "translateX(-100%)";

        setTimeout(() => {
          sliderWrapper.style.transition = "none";
          sliderWrapper.appendChild(sliderWrapper.firstElementChild);
          sliderWrapper.style.transform = "translateX(0)";
          updateClasses();
          isAnimating = false;
        }, 800);
      }

      function movePrev() {
        if (isAnimating) return;
        isAnimating = true;

        sliderWrapper.style.transition = "none";
        sliderWrapper.prepend(sliderWrapper.lastElementChild);
        sliderWrapper.style.transform = "translateX(-100%)";

        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            sliderWrapper.style.transition = "transform 0.8s cubic-bezier(0.2, 1, 0.3, 1)";
            sliderWrapper.style.transform = "translateX(0)";
          });
        });

        setTimeout(() => {
          updateClasses();
          isAnimating = false;
        }, 800);
      }

      // Swipe / Drag
      let startX = 0;
      let startY = 0;
      let pointerDown = false;

      function onDown(e) {
        if (isAnimating) return;
        pointerDown = true;
        startX = e.clientX ?? (e.touches && e.touches[0]?.clientX) ?? 0;
        startY = e.clientY ?? (e.touches && e.touches[0]?.clientY) ?? 0;
      }

      function onUp(e) {
        if (!pointerDown) return;
        pointerDown = false;
        const endX = e.clientX ?? (e.changedTouches && e.changedTouches[0]?.clientX) ?? startX;
        const endY = e.clientY ?? (e.changedTouches && e.changedTouches[0]?.clientY) ?? startY;
        const dx = endX - startX;
        const dy = endY - startY;

        if (Math.abs(dx) < 45) return;
        if (Math.abs(dx) < Math.abs(dy)) return; // vertical scroll intent

        if (dx < 0) moveNext();
        else movePrev();
      }

      sliderWrapper.addEventListener("pointerdown", onDown, { passive: true });
      window.addEventListener("pointerup", onUp, { passive: true });
      sliderWrapper.addEventListener("touchstart", onDown, { passive: true });
      window.addEventListener("touchend", onUp, { passive: true });

      setInterval(moveNext, 5000);

      // --- Contact Form Logic (GAS Integration) ---
      const contactForm = document.getElementById("myContactForm");
      contactForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const scriptURL =
          "https://script.google.com/macros/s/AKfycbyejU2HI-uJ0RX4Z091VWjFhVOI7pmPqpXoWIUY10v1iDJlsHpNvEP8-uR1vNJ1QC84/exec";

        const formData = new FormData(contactForm);
        const data = {};
        formData.forEach((value, key) => (data[key] = value));

        const btn = contactForm.querySelector("button");
        const originalText = btn.innerText;
        btn.innerText = "Sending...";
        btn.disabled = true;

        fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify(data),
        })
          .then(() => {
            alert("メッセージを送信しました！");
            contactForm.reset();
          })
          .catch((error) => {
            console.error("Error!", error.message);
            alert("送信に失敗しました。");
          })
          .finally(() => {
            btn.innerText = originalText;
            btn.disabled = false;
          });
      });
    </script>
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/stable-fluids.js"></script>
  </body>
</html>
